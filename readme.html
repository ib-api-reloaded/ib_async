<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ib_async &mdash; ib_async 2.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="canonical" href="https://ib-api-reloaded.github.io/ib_asyncreadme.html"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f5cff4aa"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API docs" href="api.html" />
    <link rel="prev" title="Contents" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ib_async
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ib_async</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#update">Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-you-can-build">What You Can Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-features">Key Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-manually">Build Manually</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-only-library">Installing Only Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-everything-enable-docs-dev-testing">Install Everything (enable docs + dev testing)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generate-docs">Generate Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-types">Check Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-package">Build Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upload-package-if-maintaining">Upload Package (if maintaining)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-interactive-brokers">Setup Interactive Brokers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download-ib-gateway-or-tws">1. Download IB Gateway or TWS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-api-access">2. Configure API Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-settings">3. Performance Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-connection-issues">4. Common Connection Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#connection-patterns">Connection Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-script-usage">Basic Script Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jupyter-notebook-usage">Jupyter Notebook Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#async-application">Async Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-connection">Basic Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-account-information">Get Account Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#historical-data">Historical Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#live-market-data">Live Market Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#place-a-simple-order">Place a Simple Order</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#more-complete-examples">More Complete Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#portfolio-monitoring">Portfolio Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#real-time-p-l-tracking">Real-time P&amp;L Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-order-management">Advanced Order Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#historical-data-analysis">Historical Data Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#library-structure">Library Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#core-components">Core Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-patterns">Key Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#development">Development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-tests">Running Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#type-checking">Type Checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-formatting">Code Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-development">Local Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contributing-guidelines">Contributing Guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#community-resources">Community Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#history">History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Code recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html"><code class="docutils literal notranslate"><span class="pre">ib_async</span></code> Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html">Links</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ib_async</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ib_async</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://github.com/ib-api-reloaded/ib_async/actions"><img alt="Build" src="https://github.com/ib-api-reloaded/ib_async/actions/workflows/test.yml/badge.svg?branch=next" /></a> <a class="reference internal" href="#"><span class="xref myst"><img alt="PyVersion" src="https://img.shields.io/badge/python-3.10+-blue.svg" /></span></a> <!-- [![Status](https://img.shields.io/badge/status-beta-green.svg)](#) --> <a class="reference external" href="https://pypi.python.org/pypi/ib_async"><img alt="PyPiVersion" src="https://img.shields.io/pypi/v/ib_async.svg" /></a> <a class="reference internal" href="#"><span class="xref myst"><img alt="License" src="https://img.shields.io/badge/license-BSD-blue.svg" /></span></a> <!-- [![Downloads](https://static.pepy.tech/badge/ib-insync)](https://pepy.tech/project/ib-insync) --> <a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/"><img alt="Docs" src="https://img.shields.io/badge/Documentation-green.svg" /></a></p>
<section id="ib-async">
<h1>ib_async<a class="headerlink" href="#ib-async" title="Link to this heading">ÔÉÅ</a></h1>
<section id="update">
<h2>Update<a class="headerlink" href="#update" title="Link to this heading">ÔÉÅ</a></h2>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">ÔÉÅ</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ib_async</span></code> is a Python library that provides a clean, modern interface to Interactive Brokers‚Äô Trader Workstation (TWS) and IB Gateway. It handles the complexities of the <a class="reference external" href="https://ibkrcampus.com/ibkr-api-page/twsapi-doc/">IBKR API</a> so you can focus on building trading applications, research tools, and market data analysis.</p>
<section id="what-you-can-build">
<h3>What You Can Build<a class="headerlink" href="#what-you-can-build" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><strong>Market Data Applications</strong>: Stream live quotes, historical data, and market depth</p></li>
<li><p><strong>Trading Systems</strong>: Place, modify, and monitor orders programmatically</p></li>
<li><p><strong>Portfolio Tools</strong>: Track positions, account balances, and P&amp;L in real-time</p></li>
<li><p><strong>Research Platforms</strong>: Analyze contract details, option chains, and fundamental data</p></li>
<li><p><strong>Risk Management</strong>: Monitor exposures and implement automated controls</p></li>
</ul>
</section>
<section id="key-features">
<h3>Key Features<a class="headerlink" href="#key-features" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><strong>Simple and Intuitive</strong>: Write straightforward Python code without dealing with callback complexity</p></li>
<li><p><strong>Automatic Synchronization</strong>: The <a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/api.html#module-ib_async.ib">IB component</a> stays in sync with TWS/Gateway automatically</p></li>
<li><p><strong>Async-Ready</strong>: Built on <a class="reference external" href="https://docs.python.org/3/library/asyncio.html">asyncio</a> and <a class="reference external" href="https://github.com/erdewit/eventkit">eventkit</a> for high-performance applications</p></li>
<li><p><strong>Jupyter-Friendly</strong>: Interactive development with live data in notebooks</p></li>
<li><p><strong>Production-Ready</strong>: Robust error handling, reconnection logic, and comprehensive logging</p></li>
</ul>
<p>Be sure to take a look at the
<a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/notebooks.html">notebooks</a>,
the <a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/recipes.html">recipes</a>
and the <a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/api.html">API docs</a>.</p>
</section>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">ÔÉÅ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">ib_async</span>
</pre></div>
</div>
<p>Requirements:</p>
<ul class="simple">
<li><p>Python 3.10 or higher</p>
<ul>
<li><p>We plan to support Python releases <a class="reference external" href="https://devguide.python.org/versions/">2 years back</a> which allows us to continue adding newer features and performance improvements over time.</p></li>
</ul>
</li>
<li><p>A running IB Gateway application (or TWS with API mode enabled)</p>
<ul>
<li><p><a class="reference external" href="https://www.interactivebrokers.com/en/trading/ibgateway-stable.php">stable gateway</a> ‚Äî updated every few months</p></li>
<li><p><a class="reference external" href="https://www.interactivebrokers.com/en/trading/ibgateway-latest.php">latest gateway</a> ‚Äî¬†updated weekly</p></li>
</ul>
</li>
<li><p>Make sure the <a class="reference external" href="https://ibkrcampus.com/ibkr-api-page/twsapi-doc/#tws-download">API port is enabled</a> and ‚ÄòDownload open orders on connection‚Äô is checked.</p></li>
<li><p>You may also want to increase the Java memory usage under <code class="docutils literal notranslate"><span class="pre">Configure-&gt;Settings-&gt;Memory</span> <span class="pre">Allocation</span></code> to 4096 MB minimum to prevent gateway crashes when loading bulk data.</p></li>
</ul>
<p>The ibapi package from IB is not needed. <code class="docutils literal notranslate"><span class="pre">ib_async</span></code> implements the full IBKR API binary protocol internally.</p>
</section>
<section id="build-manually">
<h2>Build Manually<a class="headerlink" href="#build-manually" title="Link to this heading">ÔÉÅ</a></h2>
<p>First, install poetry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">poetry</span> <span class="o">-</span><span class="n">U</span>
</pre></div>
</div>
<section id="installing-only-library">
<h3>Installing Only Library<a class="headerlink" href="#installing-only-library" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">install</span>
</pre></div>
</div>
</section>
<section id="install-everything-enable-docs-dev-testing">
<h3>Install Everything (enable docs + dev testing)<a class="headerlink" href="#install-everything-enable-docs-dev-testing" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">install</span> <span class="o">--</span><span class="k">with</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span><span class="n">dev</span>
</pre></div>
</div>
</section>
</section>
<section id="generate-docs">
<h2>Generate Docs<a class="headerlink" href="#generate-docs" title="Link to this heading">ÔÉÅ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">install</span> <span class="o">--</span><span class="k">with</span><span class="o">=</span><span class="n">docs</span>
<span class="n">poetry</span> <span class="n">run</span> <span class="n">sphinx</span><span class="o">-</span><span class="n">build</span> <span class="o">-</span><span class="n">b</span> <span class="n">html</span> <span class="n">docs</span> <span class="n">html</span>
</pre></div>
</div>
</section>
<section id="check-types">
<h2>Check Types<a class="headerlink" href="#check-types" title="Link to this heading">ÔÉÅ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">run</span> <span class="n">mypy</span> <span class="n">ib_async</span>
</pre></div>
</div>
</section>
<section id="build-package">
<h2>Build Package<a class="headerlink" href="#build-package" title="Link to this heading">ÔÉÅ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">build</span>
</pre></div>
</div>
</section>
<section id="upload-package-if-maintaining">
<h2>Upload Package (if maintaining)<a class="headerlink" href="#upload-package-if-maintaining" title="Link to this heading">ÔÉÅ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">install</span>
<span class="n">poetry</span> <span class="n">config</span> <span class="n">pypi</span><span class="o">-</span><span class="n">token</span><span class="o">.</span><span class="n">pypi</span> <span class="n">your</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">token</span>
<span class="n">poetry</span> <span class="n">publish</span> <span class="o">--</span><span class="n">build</span>
</pre></div>
</div>
</section>
<section id="setup-interactive-brokers">
<h2>Setup Interactive Brokers<a class="headerlink" href="#setup-interactive-brokers" title="Link to this heading">ÔÉÅ</a></h2>
<section id="download-ib-gateway-or-tws">
<h3>1. Download IB Gateway or TWS<a class="headerlink" href="#download-ib-gateway-or-tws" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.interactivebrokers.com/en/trading/ibgateway-stable.php">IB Gateway (Stable)</a> ‚Äî Updated every few months, more stable</p></li>
<li><p><a class="reference external" href="https://www.interactivebrokers.com/en/trading/ibgateway-latest.php">IB Gateway (Latest)</a> ‚Äî Updated weekly, newest features</p></li>
<li><p><a class="reference external" href="https://www.interactivebrokers.com/en/trading/tws.php">Trader Workstation (TWS)</a> ‚Äî Full trading platform</p></li>
</ul>
</section>
<section id="configure-api-access">
<h3>2. Configure API Access<a class="headerlink" href="#configure-api-access" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p><strong>Enable API</strong>: Go to <code class="docutils literal notranslate"><span class="pre">Configure</span> <span class="pre">‚Üí</span> <span class="pre">API</span> <span class="pre">‚Üí</span> <span class="pre">Settings</span></code> and check ‚ÄúEnable ActiveX and Socket Clients‚Äù</p></li>
<li><p><strong>Set Port</strong>: Default ports are 7497 (TWS) and 4001 (Gateway). You can change these if needed.</p></li>
<li><p><strong>Allow Connections</strong>: Add <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> to ‚ÄúTrusted IPs‚Äù if connecting locally</p></li>
<li><p><strong>Download Orders</strong>: Check ‚ÄúDownload open orders on connection‚Äù to see existing orders</p></li>
</ol>
</section>
<section id="performance-settings">
<h3>3. Performance Settings<a class="headerlink" href="#performance-settings" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><strong>Memory</strong>: Go to <code class="docutils literal notranslate"><span class="pre">Configure</span> <span class="pre">‚Üí</span> <span class="pre">Settings</span> <span class="pre">‚Üí</span> <span class="pre">Memory</span> <span class="pre">Allocation</span></code> and set to 4096 MB minimum to prevent crashes with bulk data</p></li>
<li><p><strong>Timeouts</strong>: Increase API timeout settings if you experience disconnections during large data requests</p></li>
</ul>
</section>
<section id="common-connection-issues">
<h3>4. Common Connection Issues<a class="headerlink" href="#common-connection-issues" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Connection Refused</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure TWS/Gateway is running and API is enabled</span>
<span class="c1"># Check that ports match (7497 for TWS, 4001 for Gateway)</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># TWS</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">4001</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Gateway</span>
</pre></div>
</div>
<p><strong>Client ID Conflicts</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Each connection needs a unique client ID</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use different numbers for multiple connections</span>
</pre></div>
</div>
<p><strong>Market Data Issues</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For free delayed data (no subscription required)</span>
<span class="n">ib</span><span class="o">.</span><span class="n">reqMarketDataType</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Delayed</span>
<span class="n">ib</span><span class="o">.</span><span class="n">reqMarketDataType</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Delayed frozen</span>

<span class="c1"># For real-time data (requires subscription)</span>
<span class="n">ib</span><span class="o">.</span><span class="n">reqMarketDataType</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Real-time</span>
</pre></div>
</div>
</section>
</section>
<section id="connection-patterns">
<h2>Connection Patterns<a class="headerlink" href="#connection-patterns" title="Link to this heading">ÔÉÅ</a></h2>
<section id="basic-script-usage">
<h3>Basic Script Usage<a class="headerlink" href="#basic-script-usage" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Your code here</span>
<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="jupyter-notebook-usage">
<h3>Jupyter Notebook Usage<a class="headerlink" href="#jupyter-notebook-usage" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="n">util</span><span class="o">.</span><span class="n">startLoop</span><span class="p">()</span>  <span class="c1"># Required for notebooks</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Your code here - no need to call ib.run()</span>
</pre></div>
</div>
</section>
<section id="async-application">
<h3>Async Application<a class="headerlink" href="#async-application" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">ib</span><span class="o">.</span><span class="n">connectAsync</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Your async code here</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">ÔÉÅ</a></h2>
<section id="basic-connection">
<h3>Basic Connection<a class="headerlink" href="#basic-connection" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Connect to TWS or IB Gateway</span>
<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected&quot;</span><span class="p">)</span>

<span class="c1"># Disconnect when done</span>
<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get-account-information">
<h3>Get Account Information<a class="headerlink" href="#get-account-information" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get account summary</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">managedAccounts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">accountSummary</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">summary</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="historical-data">
<h3>Historical Data<a class="headerlink" href="#historical-data" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="c1"># util.startLoop()  # uncomment this line when in a notebook</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Request historical data</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Forex</span><span class="p">(</span><span class="s1">&#39;EURUSD&#39;</span><span class="p">)</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqHistoricalData</span><span class="p">(</span>
    <span class="n">contract</span><span class="p">,</span> <span class="n">endDateTime</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">durationStr</span><span class="o">=</span><span class="s1">&#39;30 D&#39;</span><span class="p">,</span>
    <span class="n">barSizeSetting</span><span class="o">=</span><span class="s1">&#39;1 hour&#39;</span><span class="p">,</span> <span class="n">whatToShow</span><span class="o">=</span><span class="s1">&#39;MIDPOINT&#39;</span><span class="p">,</span> <span class="n">useRTH</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Convert to pandas dataframe (pandas needs to be installed):</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">bars</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="live-market-data">
<h3>Live Market Data<a class="headerlink" href="#live-market-data" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Subscribe to live market data</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;SMART&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">)</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqMktData</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Print live quotes for 30 seconds</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait 1 second</span>
    <span class="k">if</span> <span class="n">ticker</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AAPL: $</span><span class="si">{</span><span class="n">ticker</span><span class="o">.</span><span class="n">last</span><span class="si">}</span><span class="s2"> (bid: $</span><span class="si">{</span><span class="n">ticker</span><span class="o">.</span><span class="n">bid</span><span class="si">}</span><span class="s2">, ask: $</span><span class="si">{</span><span class="n">ticker</span><span class="o">.</span><span class="n">ask</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="place-a-simple-order">
<h3>Place a Simple Order<a class="headerlink" href="#place-a-simple-order" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create a contract and order</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;SMART&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">MarketOrder</span><span class="p">(</span><span class="s1">&#39;BUY&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Place the order</span>
<span class="n">trade</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">placeOrder</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order placed: </span><span class="si">{</span><span class="n">trade</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Monitor order status</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">trade</span><span class="o">.</span><span class="n">isDone</span><span class="p">():</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order status: </span><span class="si">{</span><span class="n">trade</span><span class="o">.</span><span class="n">orderStatus</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="more-complete-examples">
<h2>More Complete Examples<a class="headerlink" href="#more-complete-examples" title="Link to this heading">ÔÉÅ</a></h2>
<section id="portfolio-monitoring">
<h3>Portfolio Monitoring<a class="headerlink" href="#portfolio-monitoring" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get current positions</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">positions</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Positions:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pos</span><span class="o">.</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pos</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">pos</span><span class="o">.</span><span class="n">avgCost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Get open orders</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">openTrades</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Open Orders: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">trade</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trade</span><span class="o">.</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">trade</span><span class="o">.</span><span class="n">order</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">trade</span><span class="o">.</span><span class="n">order</span><span class="o">.</span><span class="n">totalQuantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="real-time-p-l-tracking">
<h3>Real-time P&amp;L Tracking<a class="headerlink" href="#real-time-p-l-tracking" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span><span class="w"> </span><span class="nf">onPnL</span><span class="p">(</span><span class="n">pnl</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P&amp;L Update: Unrealized: $</span><span class="si">{</span><span class="n">pnl</span><span class="o">.</span><span class="n">unrealizedPnL</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Realized: $</span><span class="si">{</span><span class="n">pnl</span><span class="o">.</span><span class="n">realizedPnL</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Subscribe to P&amp;L updates</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">managedAccounts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pnl</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqPnL</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<span class="n">pnl</span><span class="o">.</span><span class="n">updateEvent</span> <span class="o">+=</span> <span class="n">onPnL</span>

<span class="c1"># Keep running to receive updates</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># Run until interrupted</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="advanced-order-management">
<h3>Advanced Order Management<a class="headerlink" href="#advanced-order-management" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create a bracket order (entry + stop loss + take profit)</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">&#39;TSLA&#39;</span><span class="p">,</span> <span class="s1">&#39;SMART&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">)</span>

<span class="c1"># Parent order</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">LimitOrder</span><span class="p">(</span><span class="s1">&#39;BUY&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">250.00</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">orderId</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getReqId</span><span class="p">()</span>
<span class="n">parent</span><span class="o">.</span><span class="n">transmit</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Stop loss</span>
<span class="n">stopLoss</span> <span class="o">=</span> <span class="n">StopOrder</span><span class="p">(</span><span class="s1">&#39;SELL&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">240.00</span><span class="p">)</span>
<span class="n">stopLoss</span><span class="o">.</span><span class="n">orderId</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getReqId</span><span class="p">()</span>
<span class="n">stopLoss</span><span class="o">.</span><span class="n">parentId</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">orderId</span>
<span class="n">stopLoss</span><span class="o">.</span><span class="n">transmit</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Take profit</span>
<span class="n">takeProfit</span> <span class="o">=</span> <span class="n">LimitOrder</span><span class="p">(</span><span class="s1">&#39;SELL&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">260.00</span><span class="p">)</span>
<span class="n">takeProfit</span><span class="o">.</span><span class="n">orderId</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getReqId</span><span class="p">()</span>
<span class="n">takeProfit</span><span class="o">.</span><span class="n">parentId</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">orderId</span>
<span class="n">takeProfit</span><span class="o">.</span><span class="n">transmit</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Place bracket order</span>
<span class="n">trades</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ib</span><span class="o">.</span><span class="n">placeOrder</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">parent</span><span class="p">))</span>
<span class="n">trades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ib</span><span class="o">.</span><span class="n">placeOrder</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">stopLoss</span><span class="p">))</span>
<span class="n">trades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ib</span><span class="o">.</span><span class="n">placeOrder</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">takeProfit</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bracket order placed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trades</span><span class="p">)</span><span class="si">}</span><span class="s2"> orders&quot;</span><span class="p">)</span>
<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="historical-data-analysis">
<h3>Historical Data Analysis<a class="headerlink" href="#historical-data-analysis" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ib_async</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">ib</span> <span class="o">=</span> <span class="n">IB</span><span class="p">()</span>
<span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get multiple timeframes</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;SMART&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">)</span>

<span class="c1"># Daily bars for 1 year</span>
<span class="n">daily_bars</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqHistoricalData</span><span class="p">(</span>
    <span class="n">contract</span><span class="p">,</span> <span class="n">endDateTime</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">durationStr</span><span class="o">=</span><span class="s1">&#39;1 Y&#39;</span><span class="p">,</span>
    <span class="n">barSizeSetting</span><span class="o">=</span><span class="s1">&#39;1 day&#39;</span><span class="p">,</span> <span class="n">whatToShow</span><span class="o">=</span><span class="s1">&#39;TRADES&#39;</span><span class="p">,</span> <span class="n">useRTH</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 5-minute bars for last 5 days</span>
<span class="n">intraday_bars</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqHistoricalData</span><span class="p">(</span>
    <span class="n">contract</span><span class="p">,</span> <span class="n">endDateTime</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">durationStr</span><span class="o">=</span><span class="s1">&#39;5 D&#39;</span><span class="p">,</span>
    <span class="n">barSizeSetting</span><span class="o">=</span><span class="s1">&#39;5 mins&#39;</span><span class="p">,</span> <span class="n">whatToShow</span><span class="o">=</span><span class="s1">&#39;TRADES&#39;</span><span class="p">,</span> <span class="n">useRTH</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Convert to DataFrames</span>
<span class="n">daily_df</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">daily_bars</span><span class="p">)</span>
<span class="n">intraday_df</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">intraday_bars</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily bars: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">daily_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intraday bars: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">intraday_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>

<span class="c1"># Calculate simple moving average</span>
<span class="n">daily_df</span><span class="p">[</span><span class="s1">&#39;SMA_20&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">daily_df</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;SMA_20&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>

<span class="n">ib</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="library-structure">
<h2>Library Structure<a class="headerlink" href="#library-structure" title="Link to this heading">ÔÉÅ</a></h2>
<section id="core-components">
<h3>Core Components<a class="headerlink" href="#core-components" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong><code class="docutils literal notranslate"><span class="pre">ib_async.ib.IB</span></code></strong> - Main interface class</p>
<ul class="simple">
<li><p>Connection management (<code class="docutils literal notranslate"><span class="pre">connect()</span></code>, <code class="docutils literal notranslate"><span class="pre">disconnect()</span></code>, <code class="docutils literal notranslate"><span class="pre">connectAsync()</span></code>)</p></li>
<li><p>Market data requests (<code class="docutils literal notranslate"><span class="pre">reqMktData()</span></code>, <code class="docutils literal notranslate"><span class="pre">reqHistoricalData()</span></code>)</p></li>
<li><p>Order management (<code class="docutils literal notranslate"><span class="pre">placeOrder()</span></code>, <code class="docutils literal notranslate"><span class="pre">cancelOrder()</span></code>)</p></li>
<li><p>Account data (<code class="docutils literal notranslate"><span class="pre">positions()</span></code>, <code class="docutils literal notranslate"><span class="pre">accountSummary()</span></code>, <code class="docutils literal notranslate"><span class="pre">reqPnL()</span></code>)</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">ib_async.contract</span></code></strong> - Financial instruments</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Stock</span></code>, <code class="docutils literal notranslate"><span class="pre">Option</span></code>, <code class="docutils literal notranslate"><span class="pre">Future</span></code>, <code class="docutils literal notranslate"><span class="pre">Forex</span></code>, <code class="docutils literal notranslate"><span class="pre">Index</span></code>, <code class="docutils literal notranslate"><span class="pre">Bond</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Contract</span></code> - Base class for all instruments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ComboLeg</span></code>, <code class="docutils literal notranslate"><span class="pre">DeltaNeutralContract</span></code> - Complex instruments</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">ib_async.order</span></code></strong> - Order types and management</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MarketOrder</span></code>, <code class="docutils literal notranslate"><span class="pre">LimitOrder</span></code>, <code class="docutils literal notranslate"><span class="pre">StopOrder</span></code>, <code class="docutils literal notranslate"><span class="pre">StopLimitOrder</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Order</span></code> - Base order class with all parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OrderStatus</span></code>, <code class="docutils literal notranslate"><span class="pre">OrderState</span></code> - Order execution tracking</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Trade</span></code> - Complete order lifecycle tracking</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">ib_async.ticker</span></code></strong> - Real-time market data</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Ticker</span></code> - Live quotes, trades, and market data</p></li>
<li><p>Automatic field updates (bid, ask, last, volume, etc.)</p></li>
<li><p>Event-driven updates via <code class="docutils literal notranslate"><span class="pre">updateEvent</span></code></p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">ib_async.objects</span></code></strong> - Data structures</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BarData</span></code> - Historical price bars</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Position</span></code> - Portfolio positions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PortfolioItem</span></code> - Portfolio details with P&amp;L</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AccountValue</span></code> - Account metrics</p></li>
</ul>
</section>
<section id="key-patterns">
<h3>Key Patterns<a class="headerlink" href="#key-patterns" title="Link to this heading">ÔÉÅ</a></h3>
<p><strong>Synchronous vs Asynchronous</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Synchronous (blocks until complete)</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqHistoricalData</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># Asynchronous (yields to event loop)</span>
<span class="n">bars</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ib</span><span class="o">.</span><span class="n">reqHistoricalDataAsync</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Event Handling</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subscribe to events</span>
<span class="k">def</span><span class="w"> </span><span class="nf">onOrderUpdate</span><span class="p">(</span><span class="n">trade</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order update: </span><span class="si">{</span><span class="n">trade</span><span class="o">.</span><span class="n">orderStatus</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ib</span><span class="o">.</span><span class="n">orderStatusEvent</span> <span class="o">+=</span> <span class="n">onOrderUpdate</span>

<span class="c1"># Or with async</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">onTicker</span><span class="p">(</span><span class="n">ticker</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Price update: </span><span class="si">{</span><span class="n">ticker</span><span class="o">.</span><span class="n">last</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ticker</span><span class="o">.</span><span class="n">updateEvent</span> <span class="o">+=</span> <span class="n">onTicker</span>
</pre></div>
</div>
<p><strong>Error Handling</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">ib</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7497</span><span class="p">,</span> <span class="n">clientId</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionRefusedError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TWS/Gateway not running or API not enabled&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">ÔÉÅ</a></h2>
<p>The complete <a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/api.html">API documentation</a>.</p>
<p><a class="reference external" href="https://ib-api-reloaded.github.io/ib_async/changelog.html">Changelog</a>.</p>
</section>
<section id="development">
<h2>Development<a class="headerlink" href="#development" title="Link to this heading">ÔÉÅ</a></h2>
<section id="running-tests">
<h3>Running Tests<a class="headerlink" href="#running-tests" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install<span class="w"> </span>--with<span class="o">=</span>dev
poetry<span class="w"> </span>run<span class="w"> </span>pytest
</pre></div>
</div>
</section>
<section id="type-checking">
<h3>Type Checking<a class="headerlink" href="#type-checking" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>mypy<span class="w"> </span>ib_async
</pre></div>
</div>
</section>
<section id="code-formatting">
<h3>Code Formatting<a class="headerlink" href="#code-formatting" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>format
poetry<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>check<span class="w"> </span>--fix
</pre></div>
</div>
</section>
<section id="local-development">
<h3>Local Development<a class="headerlink" href="#local-development" title="Link to this heading">ÔÉÅ</a></h3>
<ol class="arabic simple">
<li><p>Clone the repository:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ib-api-reloaded/ib_async.git
<span class="nb">cd</span><span class="w"> </span>ib_async
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Install dependencies:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install<span class="w"> </span>--with<span class="o">=</span>dev,docs
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Make your changes and run tests:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pytest
poetry<span class="w"> </span>run<span class="w"> </span>mypy<span class="w"> </span>ib_async
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Submit a pull request with:</p>
<ul class="simple">
<li><p>Clear description of changes</p></li>
<li><p>Tests for new functionality</p></li>
<li><p>Updated documentation if needed</p></li>
</ul>
</li>
</ol>
</section>
<section id="contributing-guidelines">
<h3>Contributing Guidelines<a class="headerlink" href="#contributing-guidelines" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>Follow existing code style (enforced by ruff)</p></li>
<li><p>Add tests for new features</p></li>
<li><p>Update documentation for user-facing changes</p></li>
<li><p>Keep commits focused and well-described</p></li>
<li><p>Be responsive to code review feedback</p></li>
</ul>
</section>
</section>
<section id="community-resources">
<h2>Community Resources<a class="headerlink" href="#community-resources" title="Link to this heading">ÔÉÅ</a></h2>
<p>If you have other public work related to <code class="docutils literal notranslate"><span class="pre">ib_async</span></code> or <code class="docutils literal notranslate"><span class="pre">ib_insync</span></code> open an issue and we can keep an active list here.</p>
<p>Projects below are not endorsed by any entity and are purely for reference or entertainment purposes.</p>
<ul class="simple">
<li><p>Adi‚Äôs livestream VODs about using IBKR APIs: <a class="reference external" href="https://www.youtube.com/playlist?list=PLCZZtBmmgxn8CFKysCkcl-B1tqRgCCNIX">Interactive Brokers API in Python</a></p></li>
<li><p>Matt‚Äôs IBKR python CLI: <a class="reference external" href="http://github.com/mattsta/icli">icli</a></p></li>
<li><p>Corporate data parsing via IBKR API: <a class="reference external" href="https://github.com/quantbelt/ib_fundamental">ib_fundamental</a></p></li>
</ul>
</section>
<section id="disclaimer">
<h2>Disclaimer<a class="headerlink" href="#disclaimer" title="Link to this heading">ÔÉÅ</a></h2>
<p>The software is provided on the conditions of the simplified BSD license.</p>
<p>This project is not affiliated with Interactive Brokers Group, Inc.</p>
<p><a class="reference external" href="https://ibkrcampus.com/ibkr-api-page/twsapi-doc/">Official Interactive Brokers API Docs</a></p>
</section>
<section id="history">
<h2>History<a class="headerlink" href="#history" title="Link to this heading">ÔÉÅ</a></h2>
<p>This library was originally created by <a class="reference external" href="https://github.com/erdewit">Ewald de Wit</a> as <a class="reference external" href="https://github.com/erdewit/tws_async"><code class="docutils literal notranslate"><span class="pre">tws_async</span></code> in early-2017</a> then became the more prominent <a class="reference external" href="https://github.com/erdewit/ib_insync"><code class="docutils literal notranslate"><span class="pre">ib_insync</span></code> library in mid-2017</a>. He maintained and improved the library for the world to use for free until his unexpected passing in early 2024. Afterward, we decided to rename the project to <code class="docutils literal notranslate"><span class="pre">ib_async</span></code> under a new github organization since we lost access to modify anything in the original repos and packaging and docs infrastructure.</p>
<p>The library is currently maintained by <a class="reference external" href="https://github.com/mattsta">Matt Stancliff</a> and we are open to adding more committers and org contributors if people show interest in helping out.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Contents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="API docs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>